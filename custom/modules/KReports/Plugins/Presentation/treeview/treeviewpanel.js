Ext.namespace('K.kreports.treeviewpanel');K.kreports.treeviewpanel.av=[{text:bi('LBL_NAME'),dataIndex:'name',sortable:false,width:150,editor:new Ext.form.TextField()},{text:bi('LBL_DISPLAY'),readOnly:true,dataIndex:'display',width:50,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['no',bi('LBL_NO')],['yes',bi('LBL_YES')],['hi',bi('LBL_HI')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined)return bi('LBL_'+value.toUpperCase());else return value;}},{text:bi('LBL_SORTSEQUENCE'),readOnly:true,dataIndex:'sort',width:50,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['-','-'],['asc',bi('LBL_SORT_ASC')],['desc',bi('LBL_SORT_DESC')],['sortable',bi('LBL_SORT_SORTABLE')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='-')return bi('LBL_SORT_'+value.toUpperCase());else return value;}},{text:bi('LBL_SORTPRIORITY'),dataIndex:'sortpriority',sortable:false,width:50,editor:new Ext.form.NumberField()},{text:bi('LBL_WIDTH'),dataIndex:'width',sortable:false,width:50,editor:new Ext.form.NumberField()},{text:bi('LBL_WIDGET'),dataIndex:'widget',sortable:false,hidden:true,width:80,editor:new Ext.form.TextField()},{header:bi('LBL_FUNCTION'),width:80,dataIndex:'summaryfunction',editor:new Ext.form.field.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,edtiable:false,store:new Ext.data.ArrayStore({fields:['value','text'],data:[['','-'],['sum',bi('LBL_FUNCTION_SUM')],['count',bi('LBL_FUNCTION_COUNT')],['avg',bi('LBL_FUNCTION_AVG')],['min',bi('LBL_FUNCTION_MIN')],['max',bi('LBL_FUNCTION_MAX')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='')return bi('LBL_FUNCTION_'+value.toUpperCase());else return value;}},{header:bi('LBL_OVERRIDETYPE'),width:160,dataIndex:'overridetype',editor:new Ext.form.field.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,edtiable:false,store:new Ext.data.ArrayStore({fields:['value','text'],data:[['','-'],['none',bi('LBL_RENDERER_NONE')],['currency',bi('LBL_RENDERER_CURRENCY')],['percentage',bi('LBL_RENDERER_PERCENTAGE')],['number',bi('LBL_RENDERER_NUMBER')],['int',bi('LBL_RENDERER_INT')],['float',bi('LBL_RENDERER_FLOAT')],['date',bi('LBL_RENDERER_DATE')],['datetime',bi('LBL_RENDERER_DATETIME')],['bool',bi('LBL_RENDERER_BOOL')],['text',bi('LBL_RENDERER_TEXT')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='')return bi('LBL_RENDERER_'+value.toUpperCase());else return value;}}];K.kreports.treeviewpanel.bD=new Ext.form.field.ComboBox({typeAhead:true,fieldLabel:'group until',triggerAction:'all',lazyRender:true,queryMode:'local',store:listGridStore,valueField:'fieldid',displayField:'name',listeners:{select:function(thisCombo){var aW=new Object();if(document.getElementById('listtypeproperties').value!='')aW=Ext.JSON.decode(document.getElementById('listtypeproperties').value);if(aW.treeViewProperties==undefined)aW.treeViewProperties=new Object();aW.treeViewProperties.stopTreeAt=thisCombo.getValue();document.getElementById('listtypeproperties').value=Ext.JSON.encode(aW);}}});K.kreports.treeviewpanel.panel=new Ext.grid.Panel({store:listGridStore,columns:K.kreports.treeviewpanel.av,plugins:[Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit:1})],sm:new Ext.selection.RowModel(),viewConfig:{markDirty:false,plugins:{dropGroup:'moduleFields',dragGroup:'moduleFields',ptype:'gridviewdragdrop',enableDrop:true},listeners:{beforedrop:function(node,data,overModel,dropPosition,dropFunctions,eOpts){if(data.records[0].$className=='K.kreports.EditViewFieldgrid.FieldsDataModel'){for(var recordCounter=0;recordCounter<data.records.length;recordCounter++){var storeIndex=this.getStore().indexOf(overModel);if(dropPosition=='after')storeIndex++;if(storeIndex==this.getStore().count())this.getStore().add({fieldid:kGuid(),path:activeTreeNodePath+'::'+data.records[recordCounter].data.id,displaypath:FieldsListingEditorGrid.title,name:data.records[recordCounter].data.name,display:'yes',sequence:this.getStore().getNextSequence(),width:'100',sort:'-',sortpriority:'',jointype:'required',sqlfunction:'-',summaryfunction:'',groupby:'no',link:'no',fixedvalue:''});else this.getStore().insert(storeIndex,{fieldid:kGuid(),path:activeTreeNodePath+'::'+data.records[recordCounter].data.id,displaypath:FieldsListingEditorGrid.title,name:data.records[recordCounter].data.name,display:'yes',sequence:this.getStore().getNextSequence(),width:'100',sort:'-',sortpriority:'',jointype:'required',sqlfunction:'-',summaryfunction:'',groupby:'no',link:'no',fixedvalue:''});this.getStore().ax();}dropFunctions.cancelDrop();return true;}else{var T=this.getStore();var newDropSequence=0;switch(dropPosition){case 'after':newDropSequence=Number(overModel.get('sequence'))+1;break;case 'before':newDropSequence=Number(overModel.get('sequence'));break;}for(var i=Number(data.records[0].get('sequence'));i<newDropSequence-1;i++){if(T.getAt(i).get('sequence')!=data.records[0].data.sequence){var newSequence=Number(T.getAt(i).get('sequence'))-1;if(newSequence<10)newSequence='0'+newSequence;T.getAt(i).set('sequence',newSequence);}}for(var i=newDropSequence-1;i<T.getCount();i++){if(T.getAt(i).get('sequence')!=data.records[0].data.sequence){var newSequence=Number(T.getAt(i).get('sequence'))+1;if(newSequence<10)newSequence='0'+newSequence;T.getAt(i).set('sequence',newSequence);}}if(newDropSequence<10)newDropSequence='0'+newDropSequence;data.records[0].set('sequence',newDropSequence);T.sort('sequence','ASC');T.ax();dropFunctions.cancelDrop();return true;}},drop:function(){}}},tbar:new Ext.Toolbar({items:[K.kreports.treeviewpanel.bD]}),initialize:function(){var aW=new Object();if(document.getElementById('listtypeproperties').value!='')aW=Ext.JSON.decode(document.getElementById('listtypeproperties').value);if(aW.treeViewProperties!=undefined&&aW.treeViewProperties.stopTreeAt!=undefined)K.kreports.treeviewpanel.bD.setValue(aW.treeViewProperties.stopTreeAt);}}); 
Ext.namespace('K.kreports.editview');Ext.define('K.kreports.editview.aD',{extend:'Ext.data.Model',fields:FieldsArray});Ext.define('K.kreports.editview.datePicker',{extend:'Ext.form.field.Date',alias:'widget.kreportdatepicker',format:cal_date_format.replace(/%/g,'')});Ext.define('K.kreports.editview.comboBox',{extend:'Ext.form.field.ComboBox',alias:'widget.kreportcombobox',valArray:[['no',bi('LBL_NO')],['yes',bi('LBL_YES')],['hid',bi('LBL_HID')]],mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[]}),valueField:'value',displayField:'text',listeners:{focus:function(thisEditor,thisEvent,thisEventOptions){thisEditor.getStore().loadData(thisEditor.valArray);}}});K.kreports.editview.store=new Ext.data.Store({id:'store',model:K.kreports.editview.aD,reCount:false,whereConditions:null,proxy:new Ext.data.HttpProxy({actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:'index.php?module=KReports&action=load_report&to_pdf=true',method:'POST',extraParams:{requester:document.getElementById('recordid').value}}),reader:new Ext.data.reader.Json({root:'records',totalProperty:'count'}),remoteSort:true,listeners:{load:function(){if(K.kreports.editview.store.reCount==true){editviewGetReportCount();K.kreports.editview.store.reCount=false;}}}});K.kreports.editview.editviewCountHandling='Synchronous';K.kreports.editview.editviewListCount=25;if(document.getElementById('listtypeproperties').value!=''){K.kreports.editview.listTypeProperties=Ext.JSON.decode(document.getElementById('listTypeProperties').value);if(K.kreports.editview.listTypeProperties.editviewProperties!=undefined&&K.kreports.editview.listTypeProperties.editviewProperties.processCount!=undefined&&K.kreports.editview.listTypeProperties.editviewProperties.processCount!='')K.kreports.editview.editviewCountHandling=K.kreports.editview.listTypeProperties.editviewProperties.processCount;if(K.kreports.editview.listTypeProperties.editviewProperties!=undefined&&K.kreports.editview.listTypeProperties.editviewProperties.listEntries!=undefined&&K.kreports.editview.listTypeProperties.editviewProperties.listEntries>0)K.kreports.editview.editviewListCount=K.kreports.editview.listTypeProperties.editviewProperties.listEntries;K.kreports.editview.store.pageSize=K.kreports.editview.editviewListCount;}switch(K.kreports.editview.editviewCountHandling){case 'None':case 'Asynchronous':K.kreports.editview.aB="Displaying Records {0} - {1}";K.kreports.editview.store.getProxy().extraParams.doCount=false;break;case 'Synchronous':K.kreports.editview.aB="Displaying Records {0} - {1} of {2}";K.kreports.editview.store.getProxy().extraParams.doCount=true;break;}K.kreports.editview.bI={};if(document.getElementById('reportoptions').value!='')K.kreports.editview.bI=Ext.JSON.decode(document.getElementById('reportoptions').value);K.kreports.editview.resultsFolded=false;if(K.kreports.editview.bI.resultsFolded!=undefined&&K.kreports.editview.bI.resultsFolded=='collapsed')K.kreports.editview.resultsFolded=true;K.kreports.editview.grid=new Ext.grid.Panel({id:'kReporterPresentation',store:K.kreports.editview.store,selType:'rowmodel',columns:ColumnsArray,monitorResize:true,autoHeight:true,minHeight:400,boxMinHeight:250,rowLoadMask:null,renderPresentation:function(){this.render('reportGrid');var position=this.getPosition();this.setHeight(Math.max(Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),Math.max(document.body.clientHeight,document.documentElement.clientHeight))-100-position[1]);},viewConfig:{markDirty:false,listeners:{itemcontextmenu:function(view,record,item,index,e){if(K.kreports.pdrilldown){K.kreports.pdrilldown.displayContextMenu(record,e);}}}},plugins:[Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit:1,listeners:{edit:function(thisEditor,thisEvent,thisEventOpts){K.kreports.editview.grid.rowLoadMask=new Ext.LoadMask(thisEvent.row);K.kreports.editview.grid.rowLoadMask.show();Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=pluginaction&plugin=edit&pluginaction=updatefield',params:{record:document.getElementById('recordid').value,changedRecord:Ext.JSON.encode(thisEvent.record.data),changedColumn:thisEvent.column.dataIndex,changedTo:thisEvent.value},success:function(response){K.kreports.editview.grid.rowLoadMask.hide();K.kreports.editview.grid.rowLoadMask.destroy();},failure:function(){},timeout:120000});}}})],reloadPresentation:function(whereConditions,snapshotid){K.kreports.editview.store.removeAll();K.kreports.editview.store.getProxy().extraParams.whereConditions=whereConditions;K.kreports.editview.store.getProxy().extraParams.snapshotid=snapshotid;if(K.kreports.editview.editviewCountHandling!='Synchronous'&&K.kreports.editview.editviewCountHandling!='None'){K.kreports.editview.store.whereConditions=whereConditions;K.kreports.editview.store.reCount=true;}K.kreports.editview.store.load({params:{start:0,limit:K.kreports.editview.editviewListCount}});},bS:function(){var bk=new Array();for(var i=0;i<K.kreports.editview.grid.columns.length;i++){bk[i]=new Object({sequence:i+1,dataIndex:K.kreports.editview.grid.columns[i].dataIndex,width:K.kreports.editview.grid.columns[i].getWidth(),isHidden:K.kreports.editview.grid.columns[i].isHidden(),sortState:K.kreports.editview.grid.columns[i].sortState});}return bk;},tools:[{type:'save',hidden:(accessLevel>0?false:true),handler:function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=save_standard_layout',params:{record:document.getElementById('recordid').value,layoutparams:Ext.JSON.encode(K.kreports.editview.grid.bS())},success:function(){}});}}],bbar:new Ext.toolbar.Paging({store:K.kreports.editview.store,displayInfo:true,displayMsg:K.kreports.editview.aB}),title:bi('LBL_STANDARDGRIDPANELTITLE'),collapsible:true,collapsed:K.kreports.editview.resultsFolded,listeners:{'viewready':function(){this.setHeight();}}});if(K.kreports.editview.editviewCountHandling!='Synchronous'&&K.kreports.editview.editviewCountHandling!='None')K.kreports.editview.store.reCount=true;K.kreports.editview.store.load({params:{start:0,limit:K.kreports.editview.editviewListCount}});function editviewGetReportCount(){Ext.Ajax.request({url:'index.php?module=KReports&action=load_report_count&to_pdf=true',success:function(result){Ext.getCmp('detailViewGrid').setTitle(bi('LBL_STANDARDGRIDPANELTITLE')+' ('+result.responseText+' records found)');K.kreports.editview.store.totalLength=80;},params:{requester:document.getElementById('recordid').value,whereConditions:K.kreports.editview.store.whereConditions}});}